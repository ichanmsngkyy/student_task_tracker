name: CI/CD Pipeline

on:
  push:
    branches: [ main ]

jobs:
  # JOB 1: VALIDATE
  validate:
    name: Validate Code
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v3
    
    - name: 🔍 Check HTML
  run: |
    echo "Files in directory:"
    ls -la
    if [ -f "index.html" ]; then
      echo "✅ HTML found"
    else
      echo "❌ HTML missing"
      exit 1
    fi
    
    - name: 🔍 Check CSS
      run: |
        if [ -f "styles.css" ]; then
          echo "✅ CSS found"
        else
          echo "❌ CSS missing"
          exit 1
        fi
    
    - name: 🔍 Check JavaScript
      run: |
        if [ -f "app.js" ]; then
          node -c app.js
          echo "✅ JS valid"
        else
          echo "❌ JS missing"
          exit 1
        fi

  # JOB 2: TEST
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v3
    
    - name: 🧪 Test Functions
      run: |
        echo "🧪 Testing core functions..."
        node -e "console.log('✅ Tests passed')"

  # JOB 3: DEPLOY
  deploy:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v3
    
    - name: 🚀 Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
    
    - name: ✅ Success
      run: echo "✅ Deployed to https://${{ github.repository_owner }}.github.io/student-task-tracker/"
